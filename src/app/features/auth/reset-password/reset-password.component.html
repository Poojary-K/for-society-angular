<div class="reset-overlay" (click)="goBack()">
  <div class="reset-modal" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="goBack()" aria-label="Close">&times;</button>

    <div class="reset-content">
      @if (!token) {
        <h2 class="reset-title">Reset link invalid</h2>
        <p class="reset-subtitle">Your reset link is missing or expired. Please request a new link.</p>
        <app-button type="primary" [fullWidth]="true" (click)="navigateToForgot()">
          Request new link
        </app-button>
        <div class="reset-footer">
          <p>Remembered your password? <a (click)="navigateToLogin()">Back to login</a></p>
        </div>
      } @else if (resetSuccess) {
        <h2 class="reset-title">Password updated</h2>
        <p class="reset-subtitle">Your password was updated successfully. You can now log in.</p>
        <app-button type="primary" [fullWidth]="true" (click)="navigateToLogin()">
          Go to login
        </app-button>
      } @else {
        <h2 class="reset-title">Set a new password</h2>
        <p class="reset-subtitle">Enter a new password for your account.</p>

        <form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="reset-form">
          <app-input
            type="password"
            label="New password"
            placeholder="Enter new password"
            formControlName="newPassword"
            [required]="true"
            [error]="
              resetForm.get('newPassword')?.touched && resetForm.get('newPassword')?.errors
                ? resetForm.get('newPassword')?.hasError('required')
                  ? 'Password is required'
                  : 'Password must be at least 8 characters'
                : ''
            "
          ></app-input>

          <app-input
            type="password"
            label="Confirm password"
            placeholder="Re-enter new password"
            formControlName="confirmPassword"
            [required]="true"
            [error]="
              resetForm.get('confirmPassword')?.touched &&
              (resetForm.get('confirmPassword')?.errors || resetForm.hasError('passwordMismatch'))
                ? resetForm.hasError('passwordMismatch')
                  ? 'Passwords do not match'
                  : 'Confirm password is required'
                : ''
            "
          ></app-input>

          <app-button
            type="primary"
            [fullWidth]="true"
            [loading]="loading"
            [disabled]="resetForm.invalid"
          >
            Update password
          </app-button>
        </form>

        @if (errorMessage) {
          <div class="error-panel">
            <p class="error-text">{{ errorMessage }}</p>
          </div>
        }

        <div class="reset-footer">
          <p>Remembered your password? <a (click)="navigateToLogin()">Back to login</a></p>
        </div>
      }
    </div>
  </div>
</div>
